name: ci

concurrency:
  group: ${{ github.workflow }}-${{ github.ref }}
  cancel-in-progress: true

on:
  pull_request:
    branches:
      - main
    paths:
        - "*.go"
        - "**/*.go"
        - Dockerfile
        - docker-bake.hcl
        - .github/workflows/ci.yml
        - frontend/mariner2/Dockerfile
        - "test/fixtures/*"
        - go.mod
        - go.sum
  push:
    branches:
      - main
    paths:
      - "*.go"
      - "**/*.go"
      - Dockerfile
      - docker-bake.hcl
      - .github/workflows/ci.yml
      - frontend/mariner2/Dockerfile
      - go.mod
      - go.sum

permissions:
  contents: read

jobs:
  test-pool:
    runs-on:
      labels: ["self-hosted", "1ES.Pool=stag-azcu-mariner-2-amd64"]
    steps:
      - name: az login test run
        run: |
          set -e
          az login --identity