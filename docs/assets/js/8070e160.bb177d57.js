"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[822],{4143:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>h,frontMatter:()=>l,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"quickstart","title":"Quickstart","description":"This guide shows you how to build packages and containers from source using Dalec.","source":"@site/docs/quickstart.md","sourceDirName":".","slug":"/quickstart","permalink":"/dalec/quickstart","draft":false,"unlisted":false,"editUrl":"https://github.com/project-dalec/dalec/blob/main/website/docs/quickstart.md","tags":[],"version":"current","frontMatter":{"title":"Quickstart"},"sidebar":"sidebar","previous":{"title":"Overview","permalink":"/dalec/"},"next":{"title":"Container-only builds","permalink":"/dalec/container-only-builds"}}');var a=i(4848),t=i(8453);const l={title:"Quickstart"},c=void 0,r={},d=[{value:"What is Dalec?",id:"what-is-dalec",level:2},{value:"How it Works",id:"how-it-works",level:2},{value:"Example: Building go-md2man",id:"example-building-go-md2man",level:2},{value:"Building the Package",id:"building-the-package",level:2},{value:"Build an RPM package",id:"build-an-rpm-package",level:3},{value:"Build a container image",id:"build-a-container-image",level:3}];function o(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(n.p,{children:"This guide shows you how to build packages and containers from source using Dalec."}),"\n",(0,a.jsx)(n.h2,{id:"what-is-dalec",children:"What is Dalec?"}),"\n",(0,a.jsxs)(n.p,{children:["Dalec is a ",(0,a.jsx)(n.a,{href:"https://docs.docker.com/build/buildkit/frontend/",children:"Docker Buildkit frontend"})," that translates a YAML spec into build instructions for creating packages (RPMs, DEBs) and container images. It requires only Docker to run."]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["All Dalec spec files must start with ",(0,a.jsx)(n.code,{children:"# syntax=ghcr.io/azure/dalec/frontend:latest"})," to tell buildkit which frontend to use."]})}),"\n",(0,a.jsx)(n.h2,{id:"how-it-works",children:"How it Works"}),"\n",(0,a.jsx)(n.p,{children:"Dalec builds happen in stages:"}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Package Build"})," - Check out sources and build packages using your defined build steps"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Package Test"})," - Install and test the package in a clean environment"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Create Container"})," (optional) - Install the package(s) into a scratch image to create a container"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"example-building-go-md2man",children:"Example: Building go-md2man"}),"\n",(0,a.jsxs)(n.p,{children:["Let's build the ",(0,a.jsx)(n.code,{children:"go-md2man"})," package from source. We need:"]}),"\n",(0,a.jsxs)(n.ol,{children:["\n",(0,a.jsx)(n.li,{children:"Sources to pull from"}),"\n",(0,a.jsx)(n.li,{children:"Build instructions"}),"\n",(0,a.jsx)(n.li,{children:"Artifacts to include in the package"}),"\n"]}),"\n",(0,a.jsx)(n.p,{children:"Here's the complete Dalec spec file:"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'# syntax=ghcr.io/azure/dalec/frontend:latest\nname: go-md2man\nversion: 2.0.3\nrevision: "1"\npackager: Dalec Example\nvendor: Dalec Example\nlicense: MIT\ndescription: A tool to convert markdown into man pages (roff).\nwebsite: https://github.com/cpuguy83/go-md2man\n\nsources:\n  src:\n    generate:\n      - gomod: {}  # Pre-downloads Go modules since network is disabled during build\n    git:\n      url: https://github.com/cpuguy83/go-md2man.git\n      commit: "v2.0.3"\n\ndependencies:\n  build:\n    golang:\n\nbuild:\n  env:\n    CGO_ENABLED: "0"\n  steps:\n    - command: |\n        cd src\n        go build -o go-md2man .\n\nartifacts:\n  binaries:\n    src/go-md2man:\n\nimage:\n  entrypoint: go-md2man\n  cmd: --help\n\ntests:\n  - name: Check bin\n    files:\n      /usr/bin/go-md2man:\n        permissions: 0755\n'})}),"\n",(0,a.jsx)(n.p,{children:"Key sections explained:"}),"\n",(0,a.jsxs)(n.ul,{children:["\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Metadata"}),": Package name, version, license, and description (see ",(0,a.jsx)(n.a,{href:"/dalec/spec",children:"spec"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Sources"}),": Git qrepository to clone, with ",(0,a.jsx)(n.code,{children:"generate"})," to pre-download Go modules (see ",(0,a.jsx)(n.a,{href:"/dalec/sources",children:"sources"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Dependencies"}),": Build-time dependencies (golang) (see ",(0,a.jsx)(n.a,{href:"/dalec/spec#dependencies",children:"spec"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Build"}),": Environment variables and build commands (see ",(0,a.jsx)(n.a,{href:"/dalec/spec#build-section",children:"spec"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Artifacts"}),": Files to include in the package (see ",(0,a.jsx)(n.a,{href:"/dalec/artifacts",children:"artifacts"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Image"}),": Container entrypoint and default command (see ",(0,a.jsx)(n.a,{href:"/dalec/spec#image-section",children:"spec"}),")"]}),"\n",(0,a.jsxs)(n.li,{children:[(0,a.jsx)(n.strong,{children:"Tests"}),": Validation that the package was built correctly (see ",(0,a.jsx)(n.a,{href:"/dalec/testing",children:"testing"}),")"]}),"\n"]}),"\n",(0,a.jsx)(n.h2,{id:"building-the-package",children:"Building the Package"}),"\n",(0,a.jsx)(n.h3,{id:"build-an-rpm-package",children:"Build an RPM package"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"docker build -t go-md2man:2.0.3 -f docs/examples/go-md2man.yml --target=azlinux3/rpm --output=_output .\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This creates ",(0,a.jsx)(n.code,{children:"RPM"})," and ",(0,a.jsx)(n.code,{children:"SRPM"})," directories in ",(0,a.jsx)(n.code,{children:"_output/"})," with the built packages."]}),"\n",(0,a.jsx)(n.h3,{id:"build-a-container-image",children:"Build a container image"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-shell",children:"docker build -t go-md2man:2.0.3 -f docs/examples/go-md2man.yml --target=azlinux3 .\n"})}),"\n",(0,a.jsxs)(n.p,{children:["This produces a container image named ",(0,a.jsx)(n.code,{children:"go-md2man:2.0.3"}),"."]}),"\n",(0,a.jsx)(n.admonition,{type:"note",children:(0,a.jsxs)(n.p,{children:["See the ",(0,a.jsx)(n.a,{href:"/dalec/targets",children:"targets"})," section for all available build targets."]})})]})}function h(e={}){const{wrapper:n}={...(0,t.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(o,{...e})}):o(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var s=i(6540);const a={},t=s.createContext(a);function l(e){const n=s.useContext(t);return s.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(a):e.components||a:l(e.components),s.createElement(t.Provider,{value:n},e.children)}}}]);