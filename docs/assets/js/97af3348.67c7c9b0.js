"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[68],{3824:(e,c,n)=>{n.r(c),n.d(c,{assets:()=>r,contentTitle:()=>d,default:()=>l,frontMatter:()=>t,metadata:()=>s,toc:()=>h});const s=JSON.parse('{"id":"caches","title":"Caches","description":"In addition to the standard step-level caching that buildkit provides, you can","source":"@site/docs/caches.md","sourceDirName":".","slug":"/caches","permalink":"/dalec/caches","draft":false,"unlisted":false,"editUrl":"https://github.com/Azure/dalec/blob/main/website/docs/caches.md","tags":[],"version":"current","frontMatter":{}}');var i=n(4848),a=n(8453);const t={},d="Caches",r={},h=[{value:"Dir Cache",id:"dir-cache",level:2},{value:"Gobuild Cache",id:"gobuild-cache",level:2}];function o(e){const c={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",p:"p",pre:"pre",ul:"ul",...(0,a.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.header,{children:(0,i.jsx)(c.h1,{id:"caches",children:"Caches"})}),"\n",(0,i.jsxs)(c.p,{children:["In addition to the standard step-level caching that buildkit provides, you can\nalso configure incremental caching that persists across builds.\nThis is similar to Dockerfiles ",(0,i.jsx)(c.code,{children:"--mount=type=cache"}),"."]}),"\n",(0,i.jsx)(c.h2,{id:"dir-cache",children:"Dir Cache"}),"\n",(0,i.jsx)(c.p,{children:"Dir caches are just generic directories where you choose the cache key and sharing mode."}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-yaml",children:"caches:\n  - dir:\n      key: my_key\n      dest: /my/cache/dir\n      sharing: shared\n"})}),"\n",(0,i.jsx)(c.p,{children:"Supported sharing modes are:"}),"\n",(0,i.jsxs)(c.ul,{children:["\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.code,{children:"shared"}),": The cache is shared between all builds."]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.code,{children:"private"}),": The cache is private to the build."]}),"\n",(0,i.jsxs)(c.li,{children:[(0,i.jsx)(c.code,{children:"locked"}),": The cache is locked to the build. This is useful for caching directories that are not thread-safe."]}),"\n"]}),"\n",(0,i.jsxs)(c.p,{children:["By default, dalec will namespace these directories with a key tied to the OS and\nCPU architecture which is prepended to the key you provide. This is to help\nprevent common issues one would see for specific use-cases such as storing\nincrmental compiler caches.\nYou can disable this behavior by setting the ",(0,i.jsx)(c.code,{children:"no_auto_namespace"})," option to ",(0,i.jsx)(c.code,{children:"true"}),"."]}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-yaml",children:"caches:\n  - dir:\n      key: my_key\n      dest: /my/cache/dir\n      sharing: shared\n      no_auto_namespace: true\n"})}),"\n",(0,i.jsx)(c.p,{children:"This will disable the automatic namespacing and use the key you provide as-is."}),"\n",(0,i.jsx)(c.h2,{id:"gobuild-cache",children:"Gobuild Cache"}),"\n",(0,i.jsxs)(c.p,{children:["The gobuild cache is a special type of cache that is used to cache the results of\nthe ",(0,i.jsx)(c.code,{children:"go build"})," command.\nThis is useful for caching the results of the build, such as the binary or\nlibraries."]}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-yaml",children:"caches:\n  - gobuild:\n"})}),"\n",(0,i.jsxs)(c.p,{children:["Go build caches are always in ",(0,i.jsx)(c.code,{children:"shared"})," mode and are always namespaced with the OS and CPU architecture."]}),"\n",(0,i.jsxs)(c.p,{children:["An optional ",(0,i.jsx)(c.code,{children:"scope"})," can be provided which is added to the generated cache key.\nThis is intended for internal testing purposes, however may be useful for other\nuse-cases as well."]}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-yaml",children:"caches:\n  - gobuild:\n      scope: my_scope\n"})}),"\n",(0,i.jsxs)(c.p,{children:["Finally, when go is detected in the build environment dalec will automatically\ncreate a gobuild cache for you. This can be disabled by setting the ",(0,i.jsx)(c.code,{children:"disabled"}),"\noption to ",(0,i.jsx)(c.code,{children:"true"})," in the cache definition."]}),"\n",(0,i.jsx)(c.pre,{children:(0,i.jsx)(c.code,{className:"language-yaml",children:"caches:\n  - gobuild:\n      disabled: true\n"})})]})}function l(e={}){const{wrapper:c}={...(0,a.R)(),...e.components};return c?(0,i.jsx)(c,{...e,children:(0,i.jsx)(o,{...e})}):o(e)}},8453:(e,c,n)=>{n.d(c,{R:()=>t,x:()=>d});var s=n(6540);const i={},a=s.createContext(i);function t(e){const c=s.useContext(a);return s.useMemo((function(){return"function"==typeof e?e(c):{...c,...e}}),[c,e])}function d(e){let c;return c=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),s.createElement(a.Provider,{value:c},e.children)}}}]);