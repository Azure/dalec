"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[128],{8831:(e,n,a)=>{a.r(n),a.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>p,frontMatter:()=>i,metadata:()=>o,toc:()=>l});var t=a(4848),s=a(8453);const i={title:"Virtual Packages"},c=void 0,o={id:"virtual-packages",title:"Virtual Packages",description:"In this section, we'll go over how to build virtual packages with Dalec. Virtual packages are packages that don't install any files themselves but instead reference other packages as dependencies. They are useful for creating a package that is just a collection of dependencies.",source:"@site/docs/virtual-packages.md",sourceDirName:".",slug:"/virtual-packages",permalink:"/dalec/virtual-packages",draft:!1,unlisted:!1,editUrl:"https://github.com/Azure/dalec/blob/main/website/docs/virtual-packages.md",tags:[],version:"current",frontMatter:{title:"Virtual Packages"},sidebar:"sidebar",previous:{title:"Building from source",permalink:"/dalec/build-source"},next:{title:"Dalec Specification",permalink:"/dalec/spec"}},r={},l=[];function d(e){const n={a:"a",admonition:"admonition",code:"code",p:"p",pre:"pre",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"In this section, we'll go over how to build virtual packages with Dalec. Virtual packages are packages that don't install any files themselves but instead reference other packages as dependencies. They are useful for creating a package that is just a collection of dependencies."}),"\n",(0,t.jsx)(n.p,{children:"In this example, we'll build a virtual package that just installs other packages as dependencies."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# syntax=ghcr.io/azure/dalec/frontend:latest\nname: my-package\nversion: 1.0.0\nrevision: "1"\npackager: Contoso\nvendor: Contoso\nlicense: MIT\ndescription: A virtual package that, when installed, triggers other packages to be installed\nwebsite: http://contoso.com\n\ndependencies:\n  runtime:\n    - my-package-foo\n    - my-package-bar\n'})}),"\n",(0,t.jsx)(n.p,{children:"You can build it with:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker build -t my-package-image:1.0.0 --target=mariner2 -f my-package.yml .\n"})}),"\n",(0,t.jsx)(n.admonition,{type:"note",children:(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"syntax"})," line tells docker the parser to use so it can understand the dalec spec format. Having ",(0,t.jsx)(n.code,{children:"# syntax=ghcr.io/azure/dalec/frontend:latest"})," is required at the top of the Dalec spec file."]})}),"\n",(0,t.jsx)(n.admonition,{type:"tip",children:(0,t.jsxs)(n.p,{children:["You could also pass the dalec spec file via stdin ",(0,t.jsx)(n.code,{children:"docker build -t my-package-image:1.0.0 -< my-package.yml"}),"*\nSee ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/engine/reference/commandline/build/",children:"docker's documentation"})," for more details on how you can pass the spec file to docker."]})}),"\n",(0,t.jsxs)(n.p,{children:["This will produce a container image named ",(0,t.jsx)(n.code,{children:"my-package-image:1.0.0"})," that has the ",(0,t.jsx)(n.code,{children:"my-package"})," virtual package installed along with its runtime dependencies. By default, the produced container image is a ",(0,t.jsx)(n.a,{href:"https://hub.docker.com/_/scratch/",children:(0,t.jsx)(n.code,{children:"scratch"})})," container image that only contains the package and its dependencies. You can customize the base image to use for the produced container. Below is an example that uses the Azure Linux ",(0,t.jsx)(n.code,{children:"core"})," image as the base image which includes a shell and other tools."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'# syntax=ghcr.io/azure/dalec/frontend:latest\nname: my-package\nversion: 1.0.0\nrevision: "1"\npackager: Contoso\nvendor: Contoso\nlicense: MIT\ndescription: A virtual package that, when installed, triggers other packages to be installed\nwebsite: http://contoso.com\n\ndependencies:\n  runtime:\n    - my-package-foo\n    - my-package-bar\n\ntargets:\n  mariner2:\n    image:\n      base: mcr.microsoft.com/cbl-mariner/base/core:2.0\n'})}),"\n",(0,t.jsxs)(n.p,{children:["You can also set other image settings like entrypoint/cmd, environment variables, working directory, labels, and more. Below is an example that sets the entrypoint to ",(0,t.jsx)(n.code,{children:"/bin/sh -c"}),"."]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# syntax=ghcr.io/azure/dalec/frontend:latest\nname: my-package\nversion: 1.0.0\npackager: Contoso\nvendor: Contoso\nlicense: MIT\ndescription: A virtual package that, when installed, triggers other packages to be installed\nwebsite: http://contoso.com\n\ndependencies:\n  runtime:\n    - my-package-foo\n    - my-package-bar\n\nimage:\n    entrypoint: /bin/sh -c\n"})}),"\n",(0,t.jsx)(n.p,{children:"Note how this is at the top level of the spec and not under a build target. This means that it applies to all targets, but can also be customized per target by adding it under a target."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"targets:\n  mariner2:\n    image:\n      entrypoint: /bin/sh -c\n"})})]})}function p(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,a)=>{a.d(n,{R:()=>c,x:()=>o});var t=a(6540);const s={},i=t.createContext(s);function c(e){const n=t.useContext(i);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:c(e.components),t.createElement(i.Provider,{value:n},e.children)}}}]);