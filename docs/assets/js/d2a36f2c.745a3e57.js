"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[964],{5941:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>r,contentTitle:()=>c,default:()=>u,frontMatter:()=>l,metadata:()=>a,toc:()=>o});const a=JSON.parse('{"id":"container-only-builds","title":"Container-only builds","description":"Dalec can create minimal container images with only specific packages installed, without building from source code. This is useful for creating minimal container images with just the runtime dependencies you need.","source":"@site/docs/container-only-builds.md","sourceDirName":".","slug":"/container-only-builds","permalink":"/dalec/container-only-builds","draft":false,"unlisted":false,"editUrl":"https://github.com/Azure/dalec/blob/main/website/docs/container-only-builds.md","tags":[],"version":"current","frontMatter":{"title":"Container-only builds"},"sidebar":"sidebar","previous":{"title":"Quickstart","permalink":"/dalec/quickstart"},"next":{"title":"Virtual Packages","permalink":"/dalec/virtual-packages"}}');var t=i(4848),s=i(8453);const l={title:"Container-only builds"},c=void 0,r={},o=[{value:"How it Works",id:"how-it-works",level:2},{value:"Example: Minimal Image with curl and bash",id:"example-minimal-image-with-curl-and-bash",level:2}];function d(e){const n={a:"a",admonition:"admonition",code:"code",h2:"h2",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.R)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.p,{children:"Dalec can create minimal container images with only specific packages installed, without building from source code. This is useful for creating minimal container images with just the runtime dependencies you need."}),"\n",(0,t.jsx)(n.h2,{id:"how-it-works",children:"How it Works"}),"\n",(0,t.jsxs)(n.p,{children:["When you specify only runtime dependencies in a Dalec spec (no sources or build steps), Dalec creates a ",(0,t.jsx)(n.a,{href:"/dalec/virtual-packages",children:"Virtual Package"})," and installs it in the target base image. The result is a minimal container with only your specified packages and their dependencies."]}),"\n",(0,t.jsx)(n.h2,{id:"example-minimal-image-with-curl-and-bash",children:"Example: Minimal Image with curl and bash"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"# syntax=ghcr.io/azure/dalec/frontend:latest\nname: my-minimal-image\nversion: 0.1.0\nrevision: 1\nlicense: MIT\ndescription: A minimal image with only curl and shell access\n\ndependencies:\n  runtime:\n    curl:\n    bash:\n\nimage:\n  entrypoint: /bin/bash\n"})}),"\n",(0,t.jsx)(n.p,{children:"Build the container:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-shell",children:"docker build -f my-minimal-image.yml --target=azlinux3 -t my-minimal-image:0.1.0 .\n"})}),"\n",(0,t.jsxs)(n.p,{children:["This produces a minimal image built from ",(0,t.jsx)(n.code,{children:"scratch"})," containing:"]}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"curl"})," and ",(0,t.jsx)(n.code,{children:"bash"})]}),"\n",(0,t.jsxs)(n.li,{children:["Essential packages like ",(0,t.jsx)(n.code,{children:"prebuilt-ca-certificates"})," and ",(0,t.jsx)(n.code,{children:"tzdata"})]}),"\n",(0,t.jsx)(n.li,{children:"Dependencies of the specified packages"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["The ",(0,t.jsx)(n.code,{children:"--target=azlinux3"})," flag tells Dalec to use Azure Linux 3 repositories for package installation, even though the final image starts from scratch."]}),"\n",(0,t.jsxs)(n.admonition,{type:"tip",children:[(0,t.jsx)(n.p,{children:"Alternatively, you can omit creating a Dalec spec file by passing the dependencies directly in the command line. This is useful for quick builds without needing a spec file."}),(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:'docker build -t my-minimal-image:0.1.0 --build-arg BUILDKIT_SYNTAX=ghcr.io/azure/dalec/frontend:latest --target=azlinux3/container/depsonly -<<<"$(jq -c \'.dependencies.runtime = {"curl": {}, "bash": {}} | .image.entrypoint = "/bin/bash"\' <<<"{}" )"\n'})})]})]})}function u(e={}){const{wrapper:n}={...(0,s.R)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(d,{...e})}):d(e)}},8453:(e,n,i)=>{i.d(n,{R:()=>l,x:()=>c});var a=i(6540);const t={},s=a.createContext(t);function l(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:l(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);