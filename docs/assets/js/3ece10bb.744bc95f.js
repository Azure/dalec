"use strict";(self.webpackChunkwebsite=self.webpackChunkwebsite||[]).push([[94,528,670],{1755:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"examples/repos/msft-azl-cloud-native.yml","title":"msft-azl-cloud-native.yml","description":"Azure Linux 3 yum/dnf repository","source":"@site/docs/examples/repos/msft-azl-cloud-native.yml.md","sourceDirName":"examples/repos","slug":"/examples/repos/msft-azl-cloud-native.yml","permalink":"/dalec/examples/repos/msft-azl-cloud-native.yml","draft":false,"unlisted":false,"editUrl":"https://github.com/Azure/dalec/blob/main/website/docs/examples/repos/msft-azl-cloud-native.yml.md","tags":[],"version":"current","frontMatter":{}}');var i=s(4848),o=s(8453);const r={},a=void 0,c={},l=[{value:"Azure Linux 3 yum/dnf repository",id:"azure-linux-3-yumdnf-repository",level:3}];function d(e){const n={code:"code",h3:"h3",p:"p",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"azure-linux-3-yumdnf-repository",children:"Azure Linux 3 yum/dnf repository"}),"\n",(0,i.jsx)(n.p,{children:"This only makes sense to run on Azure Linux, which already has the necessary\nkeys installed, so this only needs to have the actual repo config file."}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"dependencies:\n  runtime:\n    # This is only in the AZL cloud-native repo\n    gatekeeper-manager: {}\n  extra_repos:\n    - config:\n        azl-cloud-native.repo:\n          inline:\n            file:\n              contents: |\n                [azurelinux-cloud-native]\n                name=Azure Linux Cloud Native $releasever $basearch\n                baseurl=https://packages.microsoft.com/azurelinux/$releasever/prod/cloud-native/$basearch\n                gpgkey=file:///etc/pki/rpm-gpg/MICROSOFT-RPM-GPG-KEY\n                gpgcheck=1\n                repo_gpgcheck=1\n                enabled=1\n                skip_if_unavailable=True\n                sslverify=1\n      envs:\n        # The repository will only be available when installing into the final container\n        - install\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},4815:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>a,default:()=>u,frontMatter:()=>r,metadata:()=>t,toc:()=>l});const t=JSON.parse('{"id":"examples/repos/msft-ubuntu.yml","title":"msft-ubuntu.yml","description":"Ubuntu example with Microsoft Ubuntu 22.04 APT repository","source":"@site/docs/examples/repos/msft-ubuntu.yml.md","sourceDirName":"examples/repos","slug":"/examples/repos/msft-ubuntu.yml","permalink":"/dalec/examples/repos/msft-ubuntu.yml","draft":false,"unlisted":false,"editUrl":"https://github.com/Azure/dalec/blob/main/website/docs/examples/repos/msft-ubuntu.yml.md","tags":[],"version":"current","frontMatter":{}}');var i=s(4848),o=s(8453);const r={},a=void 0,c={},l=[{value:"Ubuntu example with Microsoft Ubuntu 22.04 APT repository",id:"ubuntu-example-with-microsoft-ubuntu-2204-apt-repository",level:3}];function d(e){const n={code:"code",h3:"h3",pre:"pre",...(0,o.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.h3,{id:"ubuntu-example-with-microsoft-ubuntu-2204-apt-repository",children:"Ubuntu example with Microsoft Ubuntu 22.04 APT repository"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"dependencies:\n  build:\n    # This is not available in the main Ubuntu repos\n    # It will be supplied by the repository we are adding here.\n    msft-golang:\n  extra_repos:\n    - keys:\n       # Note: The name for the key must use the proper `.gpg` (binary) or `.asc` (ascii)\n       # extension, or apt will not be able to import the key properly\n        msft.asc:\n          http:\n            url: https://packages.microsoft.com/keys/microsoft.asc\n            digest: sha256:2cfd20a306b2fa5e25522d78f2ef50a1f429d35fd30bd983e2ebffc2b80944fa\n            permissions: 0o644\n      config:\n        microsoft-prod.list:\n          inline:\n            file:\n              # Note the `signed-by` path is always going to be `/usr/share/keyrings/<source key name>` for Ubuntu, in this case our source key name is `msft.asc`\n              contents: deb [arch=amd64,arm64,armhf signed-by=/usr/share/keyrings/msft.asc] https://packages.microsoft.com/ubuntu/22.04/prod jammy main\n      envs:\n        # The repository will only be available when installing build dependencies\n        - build\n"})})]})}function u(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},6530:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>l,default:()=>h,frontMatter:()=>c,metadata:()=>t,toc:()=>u});const t=JSON.parse('{"id":"repositories","title":"Extra Repository Configs","description":"When you need to reference packages from repositories not in the worker\'s","source":"@site/docs/repositories.md","sourceDirName":".","slug":"/repositories","permalink":"/dalec/repositories","draft":false,"unlisted":false,"editUrl":"https://github.com/Azure/dalec/blob/main/website/docs/repositories.md","tags":[],"version":"current","frontMatter":{"title":"Extra Repository Configs"},"sidebar":"sidebar","previous":{"title":"Artifacts","permalink":"/dalec/artifacts"},"next":{"title":"Signing Packages","permalink":"/dalec/signing"}}');var i=s(4848),o=s(8453),r=s(4815),a=s(1755);const c={title:"Extra Repository Configs"},l=void 0,d={},u=[{value:"Examples:",id:"examples",level:3},...r.toc,...a.toc];function p(e){const n={a:"a",admonition:"admonition",code:"code",h3:"h3",li:"li",p:"p",strong:"strong",ul:"ul",...(0,o.R)(),...e.components},{Details:s}=n;return s||function(e,n){throw new Error("Expected "+(n?"component":"object")+" `"+e+"` to be defined: you likely forgot to import, pass, or provide it.")}("Details",!0),(0,i.jsxs)(i.Fragment,{children:[(0,i.jsxs)(n.p,{children:["When you need to reference packages from repositories not in the worker's\nrepository config you can use the ",(0,i.jsx)(n.code,{children:"extra_repos"})," field in the ",(0,i.jsx)(n.a,{href:"spec#dependencies-section",children:"dependencies\nsection"})," to inject extra repositories at\nthe right time so those dependencies can be satisfied."]}),"\n",(0,i.jsxs)(n.p,{children:["The ",(0,i.jsx)(n.code,{children:"extra_repos"})," field takes a list of repository configs with the following\nstructure:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"keys"})}),"\nA map of keys required to enable the configured repositories. Each key in\nthis map is associated with a specific source and must be imported to allow\nthe repositories to function as expected. The content of this is a\n",(0,i.jsx)(n.a,{href:"/dalec/sources",children:"source"})," just like in the sources section."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"config"})}),"\nA collection of repository configurations to add to the environment. The\nstructure and format of these configurations are specific to the distribution\nbeing used (e.g., apt or yum configurations). The content of this is a\n",(0,i.jsx)(n.a,{href:"/dalec/sources",children:"source"})," just like in the sources section."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"data"})}),"\nA list of additional data required to support the repository configurations.\nThis may include files or other resources essential for certain\nconfigurations, particularly file-backed repositories that need data not\nalready available in the environment. The content of this is a mount which\ntakes a ",(0,i.jsx)(n.code,{children:"dest"})," field for where the content should be mounted in the build env\nand a ",(0,i.jsx)(n.code,{children:"spec"})," field, the content of which is a ",(0,i.jsx)(n.a,{href:"/dalec/sources",children:"source"})," just like\nin the sources section. Usage of ",(0,i.jsx)(n.code,{children:"data"})," is considered an advanced case and,\naside from creating local repositories, is likely not necessary for most\nuses."]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"envs"})}),"\nSpecifies the environments in which the repositories should be made\navailable. Possible values are:"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"build"})})," - Adds repositories before installing build dependencies."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"test"})})," - Adds repositories before installing test dependencies."]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:(0,i.jsx)(n.code,{children:"install"})})," - Adds repositories before installing the final package in a\ncontainer build target."]}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:"These configurations are highly distribution specific."}),"\n",(0,i.jsx)(n.admonition,{type:"tip",children:(0,i.jsxs)(n.p,{children:["Be careful to name the key files properly depending on whether they are ascii armored (",(0,i.jsx)(n.code,{children:"*.asc"}),") or binary (",(0,i.jsx)(n.code,{children:"*.gpg"}),").\nSome package managers such as ",(0,i.jsx)(n.code,{children:"apt"})," do not handle keys properly if they are not named with the correct extension."]})}),"\n",(0,i.jsx)(n.h3,{id:"examples",children:"Examples:"}),"\n","\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Microsoft Ubuntu repository (APT)"}),(0,i.jsx)(r.default,{})]}),"\n","\n",(0,i.jsxs)(s,{children:[(0,i.jsx)("summary",{children:"Microsoft Azure Linux cloud-native repository (DNF)"}),(0,i.jsx)(a.default,{})]})]})}function h(e={}){const{wrapper:n}={...(0,o.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(p,{...e})}):p(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>r,x:()=>a});var t=s(6540);const i={},o=t.createContext(i);function r(e){const n=t.useContext(o);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function a(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:r(e.components),t.createElement(o.Provider,{value:n},e.children)}}}]);